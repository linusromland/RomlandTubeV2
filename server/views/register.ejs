<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - RomlandTube</title>

    <!--IMPORT OF CSS-->
    <link rel="stylesheet" href="/CSS/main.css">
    <link rel="stylesheet" href="/CSS/register.css">

    <!--IMPORT OF Crypto-JS used for the hashing and salting of password-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/md5.js"></script>

    <script>
      function registerUser() {
        let password = document.getElementById("password").value;
        let confirmPassword = document.getElementById("passwordConfirm").value;
        let errorText = document.getElementById("errorText");

        if (password == confirmPassword) {
          console.log("usercreation maybe");
          let request = new XMLHttpRequest();
          let name = document.getElementById("username").value;
          let pass = CryptoJS.MD5(password + name);
          request.open("POST", "/register", false);
          request.setRequestHeader(
            "Content-type",
            "application/x-www-form-urlencoded"
          );
          request.send(`name=${name}&password=${pass}`);
          if(request.response == "taken"){
              errorText.innerHTML = "Username taken!"
          }else if(request.status == 500){
             //window.location("/")
             errorText.innerHTML = "Error occured!"
          }
        } else {
          errorText.innerHTML = "Password do not match!";
        }
      }
    </script>
  </head>
  <body>
    <form onsubmit="registerUser();return false;">
      <input type="text" placeholder="username" name="username" id="username" />
      <br />
      <input
        type="password"
        placeholder="password"
        name="password"
        id="password"
      />
      <br />
      <input
        type="password"
        placeholder="Confirm Password"
        name="ConfirmPassword"
        id="passwordConfirm"
      />
      <p id="errorText">
        <br />
      </p>
      <input type="submit" placeholder="Submit" />
    </form>
  </body>
</html>
